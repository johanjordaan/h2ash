// Generated by CoffeeScript 1.6.3
(function() {
  var __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  define(['THREE', 'underscore'], function(THREE, _) {
    var animate, render, renderers;
    renderers = {};
    render = function() {
      var p, renderer, renderer_key, v, vector, _i, _len, _ref, _results;
      _ref = _.keys(renderers);
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        renderer_key = _ref[_i];
        renderer = renderers[renderer_key];
        renderer.update();
        renderer.renderer.clear();
        renderer.renderer.render(renderer.scene, renderer.camera);
        p = new THREE.Projector();
        vector = new THREE.Vector3(3000, -3000, 3000);
        v = p.projectVector(vector, renderer.camera);
        debugger;
        renderer.sceneOrtho.children[0].position.x = 160 * v.x;
        renderer.sceneOrtho.children[0].position.y = 120 * v.y;
        renderer.sceneOrtho.children[0].position.z = 0;
        renderer.renderer.clearDepth();
        _results.push(renderer.renderer.render(renderer.sceneOrtho, renderer.cameraOrtho));
      }
      return _results;
    };
    animate = function() {
      requestAnimationFrame(animate);
      return render();
    };
    return function() {
      return {
        create_renderer: function(name, width, height, scene, sceneOrtho, camera, cameraOrtho, update) {
          var renderer;
          renderer = {};
          if (__indexOf.call(_.keys(renderers), name) >= 0) {
            renderer = renderers[name].renderer;
          } else {
            renderer = new THREE.WebGLRenderer();
          }
          renderer.setSize(width, height);
          renderer.setClearColor(0x000000, 1);
          renderer.autoClear = false;
          renderers[name] = {
            active: true,
            renderer: renderer,
            camera: camera,
            cameraOrtho: cameraOrtho,
            scene: scene,
            sceneOrtho: sceneOrtho,
            update: update
          };
          return renderers[name];
        },
        get_renderer: function(name) {
          return renderers[name].renderer;
        },
        run: function() {
          return animate();
        }
      };
    };
  });

}).call(this);
