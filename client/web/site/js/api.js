// Generated by CoffeeScript 1.6.3
(function() {
  define([], function() {
    var clear_error, set_error;
    clear_error = function(scope) {
      scope.error = false;
      return scope.error_message = '';
    };
    set_error = function(scope, message) {
      scope.error = true;
      return scope.error_message = message;
    };
    return function($http, auth) {
      return {
        pre_register: function(scope, data, cb) {
          clear_error(scope);
          return $http.post('/api/pre_registration/register', data).error(function(data, status, headers, config) {
            set_error(scope, status);
            return cb(false);
          }).success(function(data, status, headers, config) {
            if (data.error_code !== 0) {
              set_error(scope, data.error_message);
              return cb(false);
            } else {
              return cb(true);
            }
          });
        },
        login: function(scope, data, cb) {
          var email;
          clear_error(scope);
          email = data.email;
          return $http.post('/api/authentication/login', data).error(function(data, status, headers, config) {
            auth.authenticated = false;
            auth.token = '';
            set_error(scope, status);
            return cb(false);
          }).success(function(data, status, headers, config) {
            auth.authenticated = data.error_code === 0;
            if (auth.authenticated) {
              auth.token = data.auth_token;
              auth.email = email;
            } else {
              auth.token = '';
              set_error(scope, data.error_message);
            }
            return cb(auth.authenticated);
          });
        },
        get_leads: function(scope, data, cb) {
          clear_error(scope);
          data.auth_token = auth.token;
          data.auth_email = auth.email;
          return $http.post('/api/admin/get_leads', data).error(function(data, status, headers, config) {
            set_error(scope, status);
            return cb(false);
          }).success(function(data, status, headers, config) {
            auth.token = data.auth_token;
            if (data.error_code !== 0) {
              set_error(scope, data.error_message);
            }
            return cb(data.leads);
          });
        }
      };
    };
  });

}).call(this);
